#import <XCTest/XCTest.h>
#import "OCBeerXML.h"

@interface OCBeerXmlWatersTests : XCTestCase
@end

@implementation OCBeerXmlWatersTests

- (void)setUp {
    [super setUp];
}

- (void)tearDown {
    [super tearDown];
}

- (void)testMiscs {
	NSError *error;
	NSString *xml = @"<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?> <RECIPES> <RECIPE> <EQUIPMENTS> <EQUIPMENT> <NAME>Brew Pot (4 Gallon)</NAME> <VERSION>1</VERSION> <BOIL_SIZE>12.30612600</BOIL_SIZE> <BATCH_SIZE>18.927168</BATCH_SIZE> <TUN_VOLUME>15.14173400</TUN_VOLUME> <TUN_WEIGHT>1.814368</TUN_WEIGHT> <TUN_SPECIFIC_HEAT>0.120</TUN_SPECIFIC_HEAT> <TOP_UP_WATER>8.51722600</TOP_UP_WATER> <TRUB_CHILLER_LOSS>0.00000000</TRUB_CHILLER_LOSS> <EVAP_RATE>9.0</EVAP_RATE> <BOIL_TIME>60.0</BOIL_TIME> <CALC_BOIL_VOLUME>TRUE</CALC_BOIL_VOLUME> <LAUTER_DEADSPACE>0.94635800</LAUTER_DEADSPACE> <TOP_UP_KETTLE>0.00000000</TOP_UP_KETTLE> <HOP_UTILIZATION>100.0</HOP_UTILIZATION> <NOTES>Simple Brew Pot with a 4 Gallon Capacity - leaving a workable boil volume of around 3.25 gal. Used for extract or partial mash brewing.</NOTES> <DISPLAY_BOIL_SIZE>3.25 gal</DISPLAY_BOIL_SIZE> <DISPLAY_BATCH_SIZE>5.00 gal</DISPLAY_BATCH_SIZE> <DISPLAY_TUN_VOLUME>4.00 gal</DISPLAY_TUN_VOLUME> <DISPLAY_TUN_WEIGHT>4.00 lb</DISPLAY_TUN_WEIGHT> <DISPLAY_TOP_UP_WATER>2.25 gal</DISPLAY_TOP_UP_WATER> <DISPLAY_TRUB_CHILLER_LOSS>0.00 gal</DISPLAY_TRUB_CHILLER_LOSS> <DISPLAY_LAUTER_DEADSPACE>0.25 gal</DISPLAY_LAUTER_DEADSPACE> <DISPLAY_TOP_UP_KETTLE>0.00 gal</DISPLAY_TOP_UP_KETTLE> </EQUIPMENT> <EQUIPMENT> <NAME>Brew Pot (6+gal) and Igloo/Gott Cooler (5 Gal)</NAME> <VERSION>1</VERSION> <BOIL_SIZE>22.70566900</BOIL_SIZE> <BATCH_SIZE>18.927168</BATCH_SIZE> <TUN_VOLUME>18.92716800</TUN_VOLUME> <TUN_WEIGHT>1.814368</TUN_WEIGHT> <TUN_SPECIFIC_HEAT>0.300</TUN_SPECIFIC_HEAT> <TOP_UP_WATER>0.00000000</TOP_UP_WATER> <TRUB_CHILLER_LOSS>0.94635800</TRUB_CHILLER_LOSS> <EVAP_RATE>9.0</EVAP_RATE> <BOIL_TIME>60.0</BOIL_TIME> <CALC_BOIL_VOLUME>TRUE</CALC_BOIL_VOLUME> <LAUTER_DEADSPACE>0.94635800</LAUTER_DEADSPACE> <TOP_UP_KETTLE>0.00000000</TOP_UP_KETTLE> <HOP_UTILIZATION>100.0</HOP_UTILIZATION> <NOTES>Popular all grain setup. 5 Gallon Gott or Igloo cooler as mash tun with false bottom, and 7-9 gallon brewpot capable of boiling at least 6 gallons of wort. Primarily used for single infusion mashes.</NOTES> <DISPLAY_BOIL_SIZE>6.00 gal</DISPLAY_BOIL_SIZE> <DISPLAY_BATCH_SIZE>5.00 gal</DISPLAY_BATCH_SIZE> <DISPLAY_TUN_VOLUME>5.00 gal</DISPLAY_TUN_VOLUME> <DISPLAY_TUN_WEIGHT>4.00 lb</DISPLAY_TUN_WEIGHT> <DISPLAY_TOP_UP_WATER>0.00 gal</DISPLAY_TOP_UP_WATER> <DISPLAY_TRUB_CHILLER_LOSS>0.25 gal</DISPLAY_TRUB_CHILLER_LOSS> <DISPLAY_LAUTER_DEADSPACE>0.25 gal</DISPLAY_LAUTER_DEADSPACE> <DISPLAY_TOP_UP_KETTLE>0.00 gal</DISPLAY_TOP_UP_KETTLE> </EQUIPMENT> </EQUIPMENTS><NAME>Dry Stout</NAME> <VERSION>1</VERSION> <NOTES>Famous Irish Stout.</NOTES><TYPE>All Grain</TYPE> <BREWER>Brad Smith</BREWER> <BATCH_SIZE>18.93</BATCH_SIZE> <BOIL_SIZE>20.82</BOIL_SIZE> <BOIL_TIME>60.0</BOIL_TIME> <EFFICIENCY>72.0</EFFICIENCY> <TASTE_NOTES>Nice dry Irish stout with a warm body but low starting gravity much like the famous drafts.</TASTE_NOTES> <TASTE_RATING>41</TASTE_RATING> <DATE>3 Jan 04</DATE> <OG>1.036</OG> <FG>1.012</FG> <CARBONATION>2.1</CARBONATION> <CARBONATION_USED>Kegged</CARBONATION_USED> <AGE>24.0</AGE> <AGE_TEMP>17.0</AGE_TEMP> <FERMENTATION_STAGES>2</FERMENTATION_STAGES> <STYLE> <NAME>Dry Stout</NAME> <CATEGORY>Stout</CATEGORY> <CATEGORY_NUMBER>16</CATEGORY_NUMBER> <STYLE_LETTER>A</STYLE_LETTER> <STYLE_GUIDE>BJCP</STYLE_GUIDE> <VERSION>1</VERSION> <TYPE>Ale</TYPE> <OG_MIN>1.035</OG_MIN> <OG_MAX>1.050</OG_MAX> <FG_MIN>1.007</FG_MIN> <FG_MAX>1.011</FG_MAX> <IBU_MIN>30.0</IBU_MIN> <IBU_MAX>50.0</IBU_MAX> <COLOR_MIN>35.0</COLOR_MIN> <COLOR_MAX>200.0</COLOR_MAX> <ABV_MIN>3.2</ABV_MIN> <ABV_MAX>5.5</ABV_MAX> <CARB_MIN>1.6</CARB_MIN> <CARB_MAX>2.1</CARB_MAX> <NOTES>Famous Irish Stout. Dry, roasted, almost coffee like flavor. Often soured with pasteurized sour beer. Full body perception due to flaked barley, though starting gravity may be low. Dry roasted flavor.</NOTES> </STYLE> <HOPS> <HOP> <NAME>Goldings, East Kent</NAME> <VERSION>1</VERSION> <ALPHA>5.0</ALPHA> <AMOUNT>0.0638</AMOUNT> <USE>Boil</USE> <TIME>60.0</TIME> <NOTES>Great all purpose UK hop for ales, stouts, porters</NOTES> </HOP> </HOPS> <FERMENTABLES> <FERMENTABLE> <NAME>Some Fermentable</NAME> <VERSION>1</VERSION> <AMOUNT>2.27</AMOUNT> <TYPE>Grain</TYPE> <YIELD>78.0</YIELD> <COLOR>3.0</COLOR> <ORIGIN>United Kingdom</ORIGIN> <SUPPLIER>Fussybrewer Malting</SUPPLIER> <NOTES>All purpose base malt for English styles</NOTES> <COARSE_FINE_DIFF>1.5</COARSE_FINE_DIFF> <MOISTURE>4.0</MOISTURE> <DIASTATIC_POWER>45.0</DIASTATIC_POWER> <PROTEIN>10.2</PROTEIN> <MAX_IN_BATCH>100.0</MAX_IN_BATCH> </FERMENTABLE> <FERMENTABLE> <NAME>Barley, Flaked</NAME> <VERSION>1</VERSION> <AMOUNT>0.91</AMOUNT> <TYPE>Grain</TYPE> <YIELD>70.0</YIELD> <COLOR>2.0</COLOR> <ORIGIN>United Kingdom</ORIGIN> <SUPPLIER>Fussybrewer Malting</SUPPLIER> <NOTES>Adds body to porters and stouts, must be mashed</NOTES> <COARSE_FINE_DIFF>1.5</COARSE_FINE_DIFF> <MOISTURE>9.0</MOISTURE> <DIASTATIC_POWER>0.0</DIASTATIC_POWER> <PROTEIN>13.2</PROTEIN> <MAX_IN_BATCH>20.0</MAX_IN_BATCH> <RECOMMEND_MASH>TRUE</RECOMMEND_MASH> </FERMENTABLE> <FERMENTABLE> <NAME>Black Barley</NAME> <VERSION>1</VERSION> <AMOUNT>0.45</AMOUNT> <TYPE>Grain</TYPE> <YIELD>78.0</YIELD> <COLOR>500.0</COLOR> <ORIGIN>United Kingdom</ORIGIN> <SUPPLIER>Fussybrewer Malting</SUPPLIER> <NOTES>Unmalted roasted barley for stouts, porters</NOTES> <COARSE_FINE_DIFF>1.5</COARSE_FINE_DIFF> <MOISTURE>5.0</MOISTURE> <DIASTATIC_POWER>0.0</DIASTATIC_POWER> <PROTEIN>13.2</PROTEIN> <MAX_IN_BATCH>10.0</MAX_IN_BATCH> </FERMENTABLE> </FERMENTABLES> <MISCS> <MISC> <NAME>Irish Moss</NAME> <VERSION>1</VERSION> <TYPE>Fining</TYPE> <USE>Boil</USE> <TIME>15.0</TIME> <AMOUNT>0.010</AMOUNT> <NOTES>Used as a clarifying agent during the last few minutes of the boil</NOTES> </MISC> </MISCS> <WATERS> <WATER> <NAME>Burton on Trent, UK</NAME> <VERSION>1</VERSION> <AMOUNT>20.0</AMOUNT> <CALCIUM>295.0</CALCIUM> <MAGNESIUM>45.0</MAGNESIUM> <SODIUM>55.0</SODIUM> <SULFATE>725.0</SULFATE> <CHLORIDE>25.0</CHLORIDE> <BICARBONATE>300.0</BICARBONATE> <PH>8.0</PH> <NOTES>Use for distinctive pale ales strongly hopped. Very hard water accentuates the hops flavor. Example: Bass Ale</NOTES> </WATER> </WATERS> <YEASTS> <YEAST> <NAME>Irish Ale</NAME> <TYPE>Ale</TYPE> <VERSION>1</VERSION> <FORM>Liquid</FORM> <AMOUNT>0.250</AMOUNT> <LABORATORY>Wyeast Labs</LABORATORY> <PRODUCT_ID>1084</PRODUCT_ID> <MIN_TEMPERATURE>16.7</MIN_TEMPERATURE> <MAX_TEMPERATURE>22.2</MAX_TEMPERATURE> <ATTENUATION>73.0</ATTENUATION> <NOTES>Dry, fruity flavor characteristic of stouts. Full bodied, dry, clean flavor. </NOTES> <BEST_FOR>Irish Dry Stouts</BEST_FOR> <FLOCCULATION>Medium</FLOCCULATION> </YEAST> </YEASTS> <MASH> <NAME>Single Step Infusion, 68 C</NAME> <VERSION>1</VERSION> <GRAIN_TEMP>22.0</GRAIN_TEMP> <MASH_STEPS> <MASH_STEP> <NAME>Conversion Step, 68C </NAME> <VERSION>1</VERSION> <TYPE>Infusion</TYPE> <STEP_TEMP>68.0</STEP_TEMP> <STEP_TIME>60.0</STEP_TIME> <INFUSE_AMOUNT>10.0</INFUSE_AMOUNT> </MASH_STEP> </MASH_STEPS> </MASH> </RECIPE> </RECIPES> ";
	NSArray *rs = [OCBeerXML parseRecipes:xml error:&error];
	
	BXWaters *waters = [(BXRecipe*)[rs objectAtIndex:0] waters];
	XCTAssertTrue(waters.count == 1, @"Waters count is '%d', should be 1", waters.count);
	
	BXWater *water = [waters objectAtIndex:0];

	XCTAssertTrue([water.name isEqualToString:@"Burton on Trent, UK"], @"Misc name is '%@', should be 'Burton on Trent, UK'", water.name);
	XCTAssertTrue(water.version == 1, @"Version is '%d', should be '1'", water.version);
	XCTAssertTrue(water.amount == 20.f, @"Amount is '%f', should be '20.0'", water.amount);
	XCTAssertTrue(water.calcium == 295.f, @"Calcium is '%f', should be '295.0'", water.calcium);
	XCTAssertTrue(water.magnesium == 45.f, @"Magnesium is '%f', should be '45.0'", water.magnesium);
	XCTAssertTrue(water.sodium == 55.f, @"Sodium is '%f', should be '55.0'", water.sodium);
	XCTAssertTrue(water.sulfate == 725.f, @"Sulfate is '%f', should be '725.0'", water.sulfate);
	XCTAssertTrue(water.chloride == 25.f, @"Chloride is '%f', should be '25.0'", water.chloride);
	XCTAssertTrue(water.bicarbonate == 300.f, @"Bicarbonate is '%f', should be '300.0'", water.bicarbonate);
	XCTAssertTrue(water.ph == 8.f, @"PH is '%f', should be '8.0'", water.ph);
	XCTAssertTrue([water.notes isEqualToString:@"Use for distinctive pale ales strongly hopped. Very hard water accentuates the hops flavor. Example: Bass Ale"], @"Misc notes is incorrect");
}

@end
